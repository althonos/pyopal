get_property(OPAL_CPP GLOBAL PROPERTY OPAL_CPP)

list(APPEND _PLATFORMS avx2 sse2 sse4 neon)
file(READ pyx.in TEMPLATE)
foreach(_plat IN LISTS _PLATFORMS)
    string(TOUPPER ${_plat} SIMD)
    if(HAVE_${SIMD})
        configure_file(pyx.in ${_plat}.pyx)
        file(CONFIGURE CONTENT ${TEMPLATE} OUTPUT ${CMAKE_CURRENT_SOURCE_DIR}/${_plat}.pyx)
        cython_extension(${_plat} LINKS opal EXTRA_SOURCES ${OPAL_CPP})
        string(REPLACE " " ";" IMPL_FLAGS ${${SIMD}_C_FLAGS})
        foreach(_flag IN LISTS IMPL_FLAGS) 
           target_compile_options(pyopal.platform.${_plat} PUBLIC ${_flag})
        endforeach()
    endif()
endforeach()